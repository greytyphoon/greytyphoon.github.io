<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="Rémi Doutre">
	<title>Grey's Riddle</title>
	<link rel="stylesheet" href="../../system/pfGeneric.css">
	<style>
		#instructions { max-width: 540px; margin: 0 auto .75rem auto; }
		#solved { text-align: center; text-shadow: 0 0 1px var(--conjuration-green); }
		#extra-credits { text-align: center; }
		.hidden:not(.visible) { display: none; }
		.latest { text-shadow: 0 0 3px var(--murder-red); }
		form { text-align: center; position: relative; }
		form > select { position: absolute; }
		#d4 { top: 280px; margin-left: 65px; }
		#d6 { top: 270px; margin-left: -95px; }
		#d8 { top: 155px; margin-left: -105px; }
		#d10 { top: 125px; margin-left: -20px; }
		#d12 { top: 155px; margin-left: 70px; }
		#d20 { top: 210px; margin-left: -20px; }
		#d100 { top: 45px; margin-left: -20px; }
	</style>
</head>
<body onload="init()">
	<nav id="fixref"><ul>
		<li><a class="back" href="Q8-deck-of-cards.html">Back to Quest</a></li>
		<li><a class="home" href="https://greytyphoon.space/PF">Home</a></li>
	</ul></nav>

	<div class="container">
		<header>
			<h1>La porte et les joyaux, deuxième partie</h1>
		</header>
		<p>Une autre série de gemmes? Cette fois-ci elles sont dorées.</p>
		<form class="br">
			<svg height="300" width="260">
				<line x1="55" y1="180" x2="198" y2="270" style="stroke:var(--murder-black); stroke-width:2" />
				<line x1="205" y1="180" x2="75" y2="255" style="stroke:var(--murder-black); stroke-width:2" />
				<line x1="130" y1="80" x2="130" y2="180" style="stroke:var(--murder-black); stroke-width:2" />
				<polygon title="d100" points=" 130,20 170,45 160,70 130,80 100,70 90,45" style="fill:var(--abjuration-gold);stroke:var(--murder-black);stroke-width:1" />
				<polygon title="d10" points=" 130,100 170,125 160,150 130,160 100,150 90,125" style="fill:var(--abjuration-gold);stroke:var(--murder-black);stroke-width:1" />
				<polygon title="d20" points=" 130,180 170,200 170,240 130,260 90,240 90,200" style="fill:var(--abjuration-gold);stroke:var(--murder-black);stroke-width:1" />
				<polygon title="d4" points=" 210,250 240,300 180,300" style="fill:var(--abjuration-gold);stroke:var(--murder-black);stroke-width:1" />
				<polygon title="d6" points=" 30,255 75,255 75,300 30,300" style="fill:var(--abjuration-gold);stroke:var(--murder-black);stroke-width:1" />
				<polygon title="d8" points=" 40,135 70,165 40,195 10,165" style="fill:var(--abjuration-gold);stroke:var(--murder-black);stroke-width:1" />
				<polygon title="d12" points=" 220,135 250,160 235,195 205,195 190,160" style="fill:var(--abjuration-gold);stroke:var(--murder-black);stroke-width:1" />
				<line x1="220" y1="195" x2="210" y2="250" style="stroke:var(--murder-black); stroke-width:2" />
				<line x1="160" y1="150" x2="190" y2="160" style="stroke:var(--murder-black); stroke-width:2" />
				<line x1="100" y1="150" x2="70" y2="165" style="stroke:var(--murder-black); stroke-width:2" />
				<line x1="40" y1="195" x2="50" y2="255" style="stroke:var(--murder-black); stroke-width:2" />
			</svg>
			<br>
			<select id="d4" >
				<option>1</option>
				<option>2</option>
				<option>3</option>
				<option>4</option>
			</select>
			<select id="d6">
				<option>1</option>
				<option>2</option>
				<option>3</option>
				<option>4</option>
				<option>5</option>
				<option>6</option>
			</select>
			<select id="d8">
				<option>1</option>
				<option>2</option>
				<option>3</option>
				<option>4</option>
				<option>5</option>
				<option>6</option>
				<option>7</option>
				<option>8</option>
			</select>
			<select id="d10">
				<option>1</option>
				<option>2</option>
				<option>3</option>
				<option>4</option>
				<option>5</option>
				<option>6</option>
				<option>7</option>
				<option>8</option>
				<option>9</option>
				<option>10</option>
			</select>
			<select id="d100">
				<option value="100">00</option>
				<option>10</option>
				<option>20</option>
				<option>30</option>
				<option>40</option>
				<option>50</option>
				<option>60</option>
				<option>70</option>
				<option>80</option>
				<option>90</option>
			</select>
			<select id="d12">
				<option>1</option>
				<option>2</option>
				<option>3</option>
				<option>4</option>
				<option>5</option>
				<option>6</option>
				<option>7</option>
				<option>8</option>
				<option>9</option>
				<option>10</option>
				<option>11</option>
				<option>12</option>
			</select>
			<select id="d20">
				<option>1</option>
				<option>2</option>
				<option>3</option>
				<option>4</option>
				<option>5</option>
				<option>6</option>
				<option>7</option>
				<option>8</option>
				<option>9</option>
				<option>10</option>
				<option>11</option>
				<option>12</option>
				<option>13</option>
				<option>14</option>
				<option>15</option>
				<option>16</option>
				<option>17</option>
				<option>18</option>
				<option>19</option>
				<option>20</option>
			</select>
			<br>
			<button type="button" onclick="checkAnswer()">Essayer les dés comme ceci</button>
		</form>
		<div id="instructions" class="apartee hidden">
			Des mots s'affichent alors sur la porte, au-dessus des gemmes...
			<ul class="hints">
				<li class="hidden" id="column1">Le D6 et le D8 doivent avoir une somme de <b id="solutionColumn1"></b>.</li>
				<li class="hidden" id="column2">Le D20, le D10 et le D100 doivent avoir une somme de <b id="solutionColumn2"></b>.</li>
				<li class="hidden" id="column3">Le D4 et le D12 doivent avoir une somme de <b id="solutionColumn3"></b>.</li>
				<li class="hidden" id="row1">Le D8 et le D10 doivent avoir une somme de <b id="solutionRow1"></b>.</li>
				<li class="hidden" id="row2">Le D6, le D20 et le D12 doivent avoir une somme de <b id="solutionRow2"></b>.</li>
				<li class="hidden" id="traverse1">Le D10 et le D12 doivent avoir une somme de <b id="solutionTraverse1"></b>.</li>
				<li class="hidden" id="traverse2">Le D8, le D20 et le D4 doivent avoir une somme de <b id="solutionTraverse2"></b>.</li>
			</ul>
		</div>
		<p id="solved" class="hidden">La porte s'ouvre avec un bruit sourd.</p>
		<p id="extra-credits" class="hidden">Solution originale!</p>
	</div>
	<script>
		var solutionD4 = myRandom(4);
		var solutionD6 = myRandom(6);
		var solutionD8 = myRandom(8);
		var solutionD10 = myRandom(10);
		var solutionD12 = myRandom(12);
		var solutionD20 = myRandom(20);
		var solutionD100 = myRandom(10)*10;
		
		function init() {
			document.getElementById("solutionColumn1").innerHTML = solutionD6 + solutionD8;
			document.getElementById("solutionColumn2").innerHTML = solutionD20 + solutionD10 + solutionD100;
			document.getElementById("solutionColumn3").innerHTML = solutionD4 + solutionD12;
			document.getElementById("solutionRow1").innerHTML = solutionD8 + solutionD10;
			document.getElementById("solutionRow2").innerHTML = solutionD6 + solutionD20 + solutionD12;
			document.getElementById("solutionTraverse1").innerHTML = solutionD10 + solutionD12;
			document.getElementById("solutionTraverse2").innerHTML = solutionD8 + solutionD20 + solutionD4;
		}
		
		function checkAnswer() {
			let answerD4 = parseInt(document.getElementById("d4").value);
			let answerD6 = parseInt(document.getElementById("d6").value);
			let answerD8 = parseInt(document.getElementById("d8").value);
			let answerD10 = parseInt(document.getElementById("d10").value);
			let answerD100 = parseInt(document.getElementById("d100").value);
			let answerD12 = parseInt(document.getElementById("d12").value);
			let answerD20 = parseInt(document.getElementById("d20").value);

			// RULE #1
			if (answerD6 + answerD8 !== solutionD6 + solutionD8)
			{
				revealHint("column1");
				return;
			}

			// RULE #2
			if (answerD20 + answerD10 + answerD100 !== solutionD20 + solutionD10 + solutionD100)
			{
				revealHint("column2");
				return;
			}

			// RULE #3
			if (answerD4 + answerD12 !== solutionD4 + solutionD12)
			{
				revealHint("column3");
				return;
			}

			// RULE #4
			if (answerD8 + answerD10 !== solutionD8 + solutionD10)
			{
				revealHint("row1");
				return;
			}

			// RULE #5
			if (answerD6 + answerD20 + answerD12 !== solutionD6 + solutionD20 + solutionD12)
			{
				revealHint("row2");
				return;
			}

			// RULE #6
			if (answerD10 + answerD12 !== solutionD10 + solutionD12)
			{
				revealHint("traverse1");
				return;
			}

			// RULE #7
			if (answerD8 + answerD20 + answerD4 !== solutionD8 + solutionD20 + solutionD4)
			{
				revealHint("traverse1");
				return;
			}

			// SOLVED
			document.getElementById("instructions").classList.remove("visible");
			document.getElementById("solved").classList.add("visible");
			if (solutionD4 !== answerD4
			 || solutionD6 !== answerD6
			 || solutionD8 !== answerD8
			 || solutionD10 !== answerD10
			 || solutionD12 !== answerD12
			 || solutionD100 !== answerD100
			 || solutionD20 !== answerD20)
				document.getElementById("extra-credits").classList.add("visible");
		}
		function revealHint(hintId) {
			let oldLatest = document.querySelector(".latest")
			if (oldLatest) oldLatest.classList.remove("latest");

			document.getElementById("instructions").classList.add("visible");
			document.getElementById("solved").classList.remove("visible");

			let hint = document.getElementById(hintId);
			hint.classList.add("visible");
			hint.classList.add("latest");
		}
		// Returns an int between 1 and [max], including [max].
		function myRandom(max)
		{
			return Math.floor((Math.random() * max)) + 1;
		}
	</script>
</body>
</html>